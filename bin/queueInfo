#!/usr/local/bin/bash


###############################################################################
# include user defined globals and the common library
###############################################################################
. ${0%/*}/../etc/server.conf
. ${0%/*}/common.lib

# redefine $SUDO to include the configured user
if [ -n "$SUDO_USER" ]; then
    SUDO="$SUDO -u $SUDO_USER"
fi


###############################################################################
# display info
###############################################################################
$ECHO "Active Queues:"
for f in `$LS $QUEUE_ROOT/mutex_* 2> /dev/null`; do
    pid=`cat $f`
    prog=`ps -q $pid -o comm=`
    if [ "$prog" = "runQueue" ]; then
        alive=""
    else
        alive="dead"
    fi
    $PRINTF "    %6s %4s %s\n" $pid "$alive" ${f##$QUEUE_ROOT/}
done

<<<<<<< HEAD
echo "Running Jobs:"
for f in `$LS $QUEUE_ROOT/mx_* 2> /dev/null`; do
=======
echo "Running Jobs"
for f in $QUEUE_ROOT/mx_*; do
>>>>>>> 896f7c829f367c918da92804b03ec5415e4d1be6
    jobPath=`$AWK '/^jobPath:/ {printf "%s", $2}' $f`
    modName=`$AWK '/^modName:/ {printf "%s", $2}' $f`
    queue="${f#*mx_}"
    queue="${queue%%_*}"
    $PRINTF "    %2s  %-50s  %s\n" $queue ${jobPath##$JOB_ROOT/} $modName
done
