#! /bin/sh

###############################################################################
# user defined globals
#
#  all item named *_ROOT should have paths specified in canonical form
###############################################################################
BACKUPGT_ROOT=/usr/local/backupGT_server


#----
# The type of server that we are running on
# must be either 'bsd' or 'linux'
#----
SYSTEM_TYPE=bsd 


#----
# The root directory under which all backups will be stored.
#----
STORAGE_ROOT=/data/backupGT


#----
# When we are on a BSD (style) server we have the option for a) storing the backups
# on ZFS and b) backing up targets by using ZFS send/receive.  These parameters
# provide backupGT the information to (optionally) isolate backups into separate ZFS
# datasets and use the zfs.rsync backup method (if TMP_* is specifed)
#----
STORAGE_DS=data/backupGT        #the root dataset (required)
CREATE_NEW_DIRS_AS_ZFS_DS=yes   #are backups to be isolated into separate datasets

TMP_DS=data/_tmp               #only used if any target specifies the zfs.rsync method
TMP_DS_MAX_SIZE=2000G          #if set then a space limit will be set on the dataset


#----
# What user to assume when running priviledged commands
#   if we don't want/need to use sudo for priveledge escalation then define
#   but leave blank
#----
SUDO_USER=""


#----
# default retension parameters (see `backupGT -h` for more information)
#----
RETENSION="10,11,10,12,0"



# the default key file suffix for targets with reduced sshd functionality
#----
KEYFILE_SUFFIX='\.key'   #escape any special characters


#----
# This is the directory under which job queues will be stored.  The queues are
# automatically created and managed by the "enqueue" and "runQueue" scripts.
# The number of queues directly translates into how many concurrent jobs should
# be run from this server and should consider network bandwidth, local disk
# performance, and local processing capacity.  All queues are equal priority
# and serviced on a FIFO basis.
#----
QUEUE_ROOT=$BACKUPGT_ROOT/queues
NUM_QUEUES=4


#----
# This is the directory under which jobs.NNNN subdirectories should be created
# for jobs which will be managed by the runJobs script.  The 'NNNN' in the
# subdirectory name indicates the frequency which the job files within the 
# subdircetory should be run.  Eg. a subdirectory named jobs.14400 will have
# each containing job file queued for execution if the job has not 
# successfully completed witin 14400 minutes (1 day).
#----
JOB_ROOT=$BACKUPGT_ROOT/jobs


#----
# This is the directory where log files will be placed when the module being backed
# backed up is using a zfs method.  As all zfs methods replicate the source exactly
# the log files cannot be placed with the backup copy on the server.  So we need
# to have another area in which to place them.
#----
LOG_ROOT=$BACKUPGT_ROOT/log


###############################################################################
# define utility programs
###############################################################################
AWK=`which awk`
BASENAME=`which basename`
CAT=`which cat`
CHMOD=`which chmod`
CHOWN=`which chown`
CUT=`which cut`
DATE=`which date`
DIRNAME=`which dirname`
DU=`which du`
ECHO=`which echo`
ENV_CMD=`which env`
FIND=`which find`
GREP=`which grep`
HEAD=`which head`
ID=`which id`
KILL=`which kill`
LN=`which ln`
LS=`which ls`
MKDIR=`which mkdir`
MKTEMP=`which mktemp`
MV=`which mv`
NICE=`which nice`
PRINTF=`which printf`
PS=`which ps`
READLINK=`which readlink`
RM=`which rm`
RSYNC=`which rsync`
SED=`which sed`
SEQ=`which seq`
SLEEP=`which sleep`
SORT=`which sort`
SSH=`which ssh`
STAT=`which stat`
SUDO=`which sudo`
TAIL=`which tail`
TAR=`which tar`
TEE=`which tee`
UNIQ=`which uniq`
ZFS=`which zfs`

[ $SYSTEM_TYPE = "bsd" ] && ZFS=`which zfs`


###############################################################################
# ensure that all programs exist
###############################################################################
[ ! "$AWK" ]      && echo AWK       variable not defined or command not found 1>&2 && exit 1
[ ! "$BASENAME" ] && echo BASENAME  variable not defined or command not found 1>&2 && exit 1
[ ! "$CAT" ]      && echo CAT       variable not defined or command not found 1>&2 && exit 1
[ ! "$CHMOD" ]    && echo CHMOD     variable not defined or command not found 1>&2 && exit 1
[ ! "$CHOWN" ]    && echo CHOWN     variable not defined or command not found 1>&2 && exit 1
[ ! "$CUT" ]      && echo CUT       variable not defined or command not found 1>&2 && exit 1
[ ! "$DATE" ]     && echo DATE      variable not defined or command not found 1>&2 && exit 1
[ ! "$DIRNAME" ]  && echo DIRNAME   variable not defined or command not found 1>&2 && exit 1
[ ! "$DU" ]       && echo DU        variable not defined or command not found 1>&2 && exit 1
[ ! "$ECHO" ]     && echo ECHO      variable not defined or command not found 1>&2 && exit 1
[ ! "$ENV_CMD" ]  && echo ENV       variable not defined or command not found 1>&2 && exit 1
[ ! "$FIND" ]     && echo FIND      variable not defined or command not found 1>&2 && exit 1
[ ! "$GREP" ]     && echo GREP      variable not defined or command not found 1>&2 && exit 1
[ ! "$HEAD" ]     && echo HEAD      variable not defined or command not found 1>&2 && exit 1
[ ! "$ID" ]       && echo ID        variable not defined or command not found 1>&2 && exit 1
[ ! "$KILL" ]     && echo KILL      variable not defined or command not found 1>&2 && exit 1
[ ! "$LN" ]       && echo LN        variable not defined or command not found 1>&2 && exit 1
[ ! "$LS" ]       && echo LS        variable not defined or command not found 1>&2 && exit 1
[ ! "$MKDIR" ]    && echo MKDIR     variable not defined or command not found 1>&2 && exit 1
[ ! "$MKTEMP" ]   && echo MKTEMP    variable not defined or command not found 1>&2 && exit 1
[ ! "$MV" ]       && echo MV        variable not defined or command not found 1>&2 && exit 1
[ ! "$NICE" ]     && echo NICE      variable not defined or command not found 1>&2 && exit 1
[ ! "$PRINTF" ]   && echo PRINTF    variable not defined or command not found 1>&2 && exit 1
[ ! "$PS" ]       && echo PS        variable not defined or command not found 1>&2 && exit 1
[ ! "$READLINK" ] && echo READLINK  variable not defined or command not found 1>&2 && exit 1
[ ! "$RM" ]       && echo RM        variable not defined or command not found 1>&2 && exit 1
[ ! "$RSYNC" ]    && echo RSYNC     variable not defined or command not found 1>&2 && exit 1
[ ! "$SED" ]      && echo SED       variable not defined or command not found 1>&2 && exit 1
[ ! "$SEQ" ]      && echo SEQ       variable not defined or command not found 1>&2 && exit 1
[ ! "$SLEEP" ]    && echo SLEEP     variable not defined or command not found 1>&2 && exit 1
[ ! "$SORT" ]     && echo SORT      variable not defined or command not found 1>&2 && exit 1
[ ! "$SSH" ]      && echo SSH       variable not defined or command not found 1>&2 && exit 1
[ ! "$STAT" ]     && echo STAT      variable not defined or command not found 1>&2 && exit 1
[ ! "$SUDO" ]     && echo SUDO      variable not defined or command not found 1>&2 && exit 1
[ ! "$TAIL" ]     && echo TAIL      variable not defined or command not found 1>&2 && exit 1
[ ! "$TAR" ]      && echo TAR       variable not defined or command not found 1>&2 && exit 1
[ ! "$TEE" ]      && echo TEE       variable not defined or command not found 1>&2 && exit 1
[ ! "$UNIQ" ]     && echo UNIQ      variable not defined or command not found 1>&2 && exit 1

[ $SYSTEM_TYPE = "bsd" ] && [ ! "$ZFS" ]  \
                  && echo ZFS       variable not defined or command not found 1>&2 && exit 1

